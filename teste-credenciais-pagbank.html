<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste de Credenciais PagBank</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .result { background: #2a2a2a; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîê Teste de Credenciais PagBank</h1>

    <button onclick="testarChavePublica()">1. Testar Chave P√∫blica</button>
    <div id="result-key" class="result"></div>

    <button onclick="testarToken()">2. Testar Token (API Call Simples)</button>
    <div id="result-token" class="result"></div>

    <script>
        async function testarChavePublica() {
            const div = document.getElementById('result-key');
            div.innerHTML = '‚è≥ Testando chave p√∫blica...';

            try {
                const response = await fetch('/api/pagbank-public-key');
                const data = await response.json();

                if (response.ok) {
                    div.className = 'result success';
                    div.innerHTML = `
                        ‚úÖ <strong>Chave P√∫blica Obtida:</strong><br>
                        Ambiente: ${data.environment}<br>
                        Chave (primeiros 50 chars): ${data.publicKey.substring(0, 50)}...<br>
                        Tamanho total: ${data.publicKey.length} caracteres
                    `;

                    // Testar criptografia
                    const testCard = window.PagSeguro.encryptCard({
                        publicKey: data.publicKey,
                        holder: "TESTE",
                        number: "4539620659922097",
                        expMonth: "03",
                        expYear: "2026",
                        securityCode: "123"
                    });

                    div.innerHTML += `<br><br>‚úÖ Criptografia funcionando!<br>Encrypted (50 chars): ${testCard.encryptedCard.substring(0, 50)}...`;
                } else {
                    div.className = 'result error';
                    div.innerHTML = `‚ùå Erro ao obter chave: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                div.className = 'result error';
                div.innerHTML = `‚ùå Erro: ${error.message}`;
            }
        }

        async function testarToken() {
            const div = document.getElementById('result-token');
            div.innerHTML = '‚è≥ Testando token com chamada simples...';

            try {
                // Payload m√≠nimo s√≥ para validar o token
                const minimalTest = {
                    test: true
                };

                const response = await fetch('https://sandbox.api.pagseguro.com/orders', {
                    method: 'OPTIONS', // Testa apenas conectividade
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                div.className = 'result success';
                div.innerHTML = `
                    ‚úÖ <strong>Endpoint acess√≠vel:</strong><br>
                    Status: ${response.status}<br>
                    Headers: ${JSON.stringify([...response.headers.entries()], null, 2)}
                `;
            } catch (error) {
                div.className = 'result error';
                div.innerHTML = `‚ùå Erro de conex√£o: ${error.message}`;
            }
        }
    </script>

    <script src="https://assets.pagseguro.com.br/checkout-sdk-js/rc/dist/browser/pagseguro.min.js"></script>
</body>
</html>
